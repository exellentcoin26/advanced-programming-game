<html><head><meta content="text/html; charset=UTF-8" http-equiv="content-type"><style type="text/css">@import url('https://themes.googleusercontent.com/fonts/css?kit=lhDjYqiy3mZ0x6ROQEUoUw');ol{margin:0;padding:0}table td,table th{padding:0}.c15{border-right-style:solid;padding:5pt 5pt 5pt 5pt;border-bottom-color:#000000;border-top-width:0pt;border-right-width:0pt;border-left-color:#000000;vertical-align:top;border-right-color:#000000;border-left-width:0pt;border-top-style:solid;background-color:#282828;border-left-style:solid;border-bottom-width:0pt;width:468pt;border-top-color:#000000;border-bottom-style:solid}.c20{color:#000000;font-weight:400;text-decoration:none;vertical-align:baseline;font-size:26pt;font-family:"Arial";font-style:normal}.c2{color:#000000;font-weight:400;text-decoration:none;vertical-align:baseline;font-size:11pt;font-family:"Arial";font-style:normal}.c8{padding-top:18pt;padding-bottom:6pt;line-height:1.15;page-break-after:avoid;orphans:2;widows:2;text-align:left}.c17{color:#000000;font-weight:400;text-decoration:none;vertical-align:baseline;font-size:16pt;font-family:"Arial";font-style:normal}.c14{padding-top:0pt;padding-bottom:3pt;line-height:1.15;page-break-after:avoid;orphans:2;widows:2;text-align:left}.c7{padding-top:0pt;padding-bottom:0pt;line-height:1.15;orphans:2;widows:2;text-align:left}.c4{background-color:#282828;font-family:"Consolas";font-style:italic;color:#928374;font-weight:400}.c19{padding-top:18pt;padding-bottom:6pt;line-height:1.15;page-break-after:avoid;text-align:left}.c11{background-color:#282828;font-family:"Consolas";color:#d3869b;font-weight:400}.c13{padding-top:0pt;padding-bottom:0pt;line-height:1.15;text-align:left}.c10{border-spacing:0;border-collapse:collapse;margin-right:auto}.c0{background-color:#282828;font-family:"Consolas";color:#fabd2f;font-weight:400}.c5{background-color:#282828;font-family:"Consolas";color:#fb4934;font-weight:400}.c6{background-color:#282828;font-family:"Consolas";color:#83a598;font-weight:400}.c1{background-color:#282828;font-family:"Consolas";color:#8ec07c;font-weight:400}.c3{background-color:#282828;font-family:"Consolas";color:#ebdbb2;font-weight:400}.c18{background-color:#ffffff;max-width:468pt;padding:72pt 72pt 72pt 72pt}.c16{height:11pt}.c12{text-indent:36pt}.c9{height:0pt}.title{padding-top:0pt;color:#000000;font-size:26pt;padding-bottom:3pt;font-family:"Arial";line-height:1.15;page-break-after:avoid;orphans:2;widows:2;text-align:left}.subtitle{padding-top:0pt;color:#666666;font-size:15pt;padding-bottom:16pt;font-family:"Arial";line-height:1.15;page-break-after:avoid;orphans:2;widows:2;text-align:left}li{color:#000000;font-size:11pt;font-family:"Arial"}p{margin:0;color:#000000;font-size:11pt;font-family:"Arial"}h1{padding-top:20pt;color:#000000;font-size:20pt;padding-bottom:6pt;font-family:"Arial";line-height:1.15;page-break-after:avoid;orphans:2;widows:2;text-align:left}h2{padding-top:18pt;color:#000000;font-size:16pt;padding-bottom:6pt;font-family:"Arial";line-height:1.15;page-break-after:avoid;orphans:2;widows:2;text-align:left}h3{padding-top:16pt;color:#434343;font-size:14pt;padding-bottom:4pt;font-family:"Arial";line-height:1.15;page-break-after:avoid;orphans:2;widows:2;text-align:left}h4{padding-top:14pt;color:#666666;font-size:12pt;padding-bottom:4pt;font-family:"Arial";line-height:1.15;page-break-after:avoid;orphans:2;widows:2;text-align:left}h5{padding-top:12pt;color:#666666;font-size:11pt;padding-bottom:4pt;font-family:"Arial";line-height:1.15;page-break-after:avoid;orphans:2;widows:2;text-align:left}h6{padding-top:12pt;color:#666666;font-size:11pt;padding-bottom:4pt;font-family:"Arial";line-height:1.15;page-break-after:avoid;font-style:italic;orphans:2;widows:2;text-align:left}</style></head><body class="c18 doc-content"><p class="c14 title" id="h.1eaw5l11oaqo"><span class="c20">Meat-Boy project defense</span></p><p class="c7"><span class="c2">Jonas Caluw&eacute; s0210051</span><span style="overflow: hidden; display: inline-block; margin: 0.00px 0.00px; border: 0.00px solid #000000; transform: rotate(0.00rad) translateZ(0px); -webkit-transform: rotate(0.00rad) translateZ(0px); width: 526.50px; height: 836.57px;"><img alt="" src="images/image2.png" style="width: 1493.35px; height: 889.76px; margin-left: -471.46px; margin-top: -0.00px; transform: rotate(0.00rad) translateZ(0px); -webkit-transform: rotate(0.00rad) translateZ(0px);" title=""></span></p><h2 class="c8" id="h.oahobbycspv8"><span class="c17">Builder pattern</span></h2><a id="t.47e147eb9b372a379c8eb75d144d34118bfac1ae"></a><a id="t.0"></a><table class="c10"><tr class="c9"><td class="c15" colspan="1" rowspan="1"><p class="c13"><span class="c4">/// Game builder class used to configure `Game`.</span><span class="c3"><br></span><span class="c5">class</span><span class="c1">&nbsp;</span><span class="c6">GameBuilder</span><span class="c1">&nbsp;{</span><span class="c3">&nbsp;<br></span><span class="c5">public</span><span class="c3">: <br> &nbsp; &nbsp;GameBuilder(WindowStyle style, </span><span class="c6">std</span><span class="c3">::pair size, </span><span class="c5">const</span><span class="c3">&nbsp;</span><span class="c6">std</span><span class="c3">::</span><span class="c6">string</span><span class="c3">&amp; title, </span><span class="c5">bool</span><span class="c3">&nbsp;vsync);<br><br> &nbsp; &nbsp;</span><span class="c4">/// Sets the fps if vsync is set to true. </span><span class="c3"><br> &nbsp; &nbsp;</span><span class="c1">GameBuilder&amp; </span><span class="c6">set_fps</span><span class="c0">(u32 fps)</span><span class="c3">;<br><br> &nbsp; &nbsp;</span><span class="c4">/// Returns a new instance of `Game` with the provided config. </span><span class="c3"><br> &nbsp; &nbsp;</span><span class="c1">Game </span><span class="c6">build</span><span class="c0">()</span><span class="c1">&nbsp;const</span><span class="c3">;<br></span><span class="c5">private</span><span class="c3">:<br> &nbsp; &nbsp;</span><span class="c5">const</span><span class="c3">&nbsp;WindowStyle style;<br> &nbsp; &nbsp;</span><span class="c5">const</span><span class="c3">&nbsp;</span><span class="c6">std</span><span class="c3">::pair size;<br> &nbsp; &nbsp;</span><span class="c5">const</span><span class="c3">&nbsp;</span><span class="c6">std</span><span class="c3">::</span><span class="c6">string</span><span class="c3">&nbsp;title;<br> &nbsp; &nbsp;</span><span class="c5">const</span><span class="c3">&nbsp;</span><span class="c5">bool</span><span class="c3">&nbsp;vsync;<br> &nbsp; &nbsp;</span><span class="c6">std</span><span class="c3">::optional fps{};<br>};</span></p></td></tr></table><p class="c13 c16"><span class="c2"></span></p><p class="c7 c12"><span class="c2">A lot of systems require configuration that is often too complex to validate at compile time. This is where the &ldquo;builder-pattern&rdquo; is useful. It is found in the main game loop, level file parser and state manager.</span></p><p class="c7 c12"><span class="c2">For the main game loop, I wanted the ability to configure fps, window title, whether to lock the frame rate, window style and size. When setting `vsync` to true, an fps value should be expected. This is checked in the `build` member function. When no fps value is set, a `runtime_error` is thrown. (Note, the `u32` type is an alias for `unsigned int`. More types like this are used throughout the project)</span></p><p class="c7 c16"><span class="c2"></span></p><a id="t.da6b96dc1ce1eedd0c6a728a6e528d9f31b1abee"></a><a id="t.1"></a><table class="c10"><tr class="c9"><td class="c15" colspan="1" rowspan="1"><p class="c13"><span class="c5">class</span><span class="c1">&nbsp;</span><span class="c6">LevelInfoBuilder</span><span class="c1">&nbsp;{</span><span class="c3"><br></span><span class="c5">public</span><span class="c3">:<br> &nbsp; &nbsp;</span><span class="c1">inline </span><span class="c6">LevelInfoBuilder</span><span class="c0">(</span><span class="c6">std</span><span class="c0">::</span><span class="c6">string</span><span class="c0">&nbsp;name, u32 camera_height, f64 camera_increment)</span><span class="c3">;<br> &nbsp; &nbsp;</span><span class="c1">void </span><span class="c6">set_size</span><span class="c0">(</span><span class="c1">const</span><span class="c0">&nbsp;math::Vec2&amp; size)</span><span class="c3">;<br> &nbsp; &nbsp;</span><span class="c1">void </span><span class="c6">add_tile</span><span class="c0">(</span><span class="c1">const</span><span class="c0">&nbsp;math::Vec2&amp; tile)</span><span class="c3">;<br> &nbsp; &nbsp;</span><span class="c1">void </span><span class="c6">set_goal</span><span class="c0">(</span><span class="c1">const</span><span class="c0">&nbsp;math::Vec2&amp; goal)</span><span class="c3">;<br> &nbsp; &nbsp;</span><span class="c1">LevelInfo </span><span class="c6">build</span><span class="c0">()</span><span class="c1">&nbsp;const</span><span class="c3">;<br></span><span class="c5">private</span><span class="c3">:<br> &nbsp; &nbsp;</span><span class="c5">const</span><span class="c3">&nbsp;</span><span class="c6">std</span><span class="c3">::</span><span class="c6">string</span><span class="c3">&nbsp;name{};<br> &nbsp; &nbsp;</span><span class="c6">std</span><span class="c3">::optional&lt;math::Vec2&gt; size{};<br> &nbsp; &nbsp;</span><span class="c6">std</span><span class="c3">::</span><span class="c6">vector</span><span class="c3">&lt;math::Vec2&gt; tiles{};<br> &nbsp; &nbsp;</span><span class="c6">std</span><span class="c3">::optional&lt;math::Vec2&gt; player{};<br> &nbsp; &nbsp;</span><span class="c6">std</span><span class="c3">::optional&lt;math::Vec2&gt; goal{};<br> &nbsp; &nbsp;</span><span class="c5">const</span><span class="c3">&nbsp;u32 camera_height{};<br> &nbsp; &nbsp;</span><span class="c5">const</span><span class="c3">&nbsp;f64 camera_increment{};<br>};</span></p></td></tr></table><p class="c13 c16"><span class="c2"></span></p><p class="c13 c12"><span class="c2">The level file parser needed the pattern not because of user configurability, but because guarantees like presence of a player and goal need to be kept.</span></p><p class="c13 c12"><span class="c2">The level file parser reads the level from top to bottom, this is however undesirable when working with coordinates. I did not want the user to specify the height of the level in the level file, because this is redundant information derivable from the level itself. I wanted to invert these coordinates to transform `(0, 0)` to the bottom left-most corner. This was nicely solvable using the `build` member function. It already knows about the size of the level and thus can invert the coordinates before setting them in the `LevelInfo` struct. This also allowed me to make the value members of the `LevelInfo` struct const.</span></p><h2 class="c19" id="h.9g0027kywz81"><span class="c17">Subject class hierarchy</span></h2><p class="c7"><span style="overflow: hidden; display: inline-block; margin: 0.00px 0.00px; border: 0.00px solid #000000; transform: rotate(0.00rad) translateZ(0px); -webkit-transform: rotate(0.00rad) translateZ(0px); width: 624.00px; height: 334.50px;"><img alt="" src="images/image1.png" style="width: 624.00px; height: 334.50px; margin-left: 0.00px; margin-top: 0.00px; transform: rotate(0.00rad) translateZ(0px); -webkit-transform: rotate(0.00rad) translateZ(0px);" title=""></span></p><p class="c7 c12"><span class="c2">At first I didn&rsquo;t understand that the `Subject` class would be a marker class for anything observable. That is why, in the design I implemented, a `Subject` is anything in the world. It has a position, camera and bounding box/collider. How this impacts the design of the observer can be seen later. Objects that need physics to move or to interact with the world are `Entity`&rsquo;s. Entities have velocity and acceleration. Entities collide only with tiles.</span></p><h2 class="c8" id="h.dmv7vytvo4p2"><span class="c17">Observer pattern</span></h2><p class="c7"><span class="c2">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;As seen in the paragraph above, I have no class that marks a hierarchy as `Observable`. Instead, I chose to implement this using templates.</span></p><a id="t.5a8099729d11cdddcdaceddb2db3e87d5e170018"></a><a id="t.2"></a><table class="c10"><tr class="c9"><td class="c15" colspan="1" rowspan="1"><p class="c13"><span class="c4">/// Abstract observer class</span><span class="c3"><br></span><span class="c5">template</span><span class="c3">&nbsp;&lt;</span><span class="c5">typename</span><span class="c3">&nbsp;T&gt;<br></span><span class="c5">class</span><span class="c1">&nbsp;</span><span class="c6">Observer</span><span class="c1">&nbsp;{</span><span class="c3"><br></span><span class="c5">public</span><span class="c3">:<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="c5">virtual</span><span class="c3">&nbsp;~Observer() = </span><span class="c5">default</span><span class="c3">;<br><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="c4">/// Notify the observer of its task.</span><span class="c3"><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="c1">virtual void </span><span class="c6">notify</span><span class="c0">(</span><span class="c1">const</span><span class="c0">&nbsp;T&amp; source, ObserverEvent event)</span><span class="c1">&nbsp;</span><span class="c3">= </span><span class="c11">0</span><span class="c3">;<br><br></span><span class="c5">protected</span><span class="c3">:<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Observer() = </span><span class="c5">default</span><span class="c3">;<br>};</span></p></td></tr></table><p class="c13"><span class="c2">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;An `Observer` is anything that can be notified of an action. When it is notified, it is up to the observer to decide whether it is interested in the event and to extract the needed information from the object using its public interface. The template parameter specifies what the observer is looking at and what it can extract information from.</span></p><p class="c13"><span class="c2">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;This design has a couple of drawbacks. First of all, every class that wants to be observable needs to implement and maintain a list of observers. Second, with the current design it is somewhat cumbersome to store observers, since the template parameter needs to match. This did not matter in this project, but is something that possibly limits the implementations of other types of projects.</span></p><h2 class="c19" id="h.b6nozvyrisjy"><span class="c17">State manager and resource manager</span></h2><p class="c7"><span class="c2">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;I again forgot to thoroughly read ahead when starting to program and did not realize that the `StateManager` should be in charge of changing levels. The current implementation uses a singleton `ResourceManager`. This keeps track of the parsed levels and the current active level.</span></p><h2 class="c8" id="h.n2gmjk15007a"><span class="c17">Jump and wall detection</span></h2><a id="t.39e01740efa277950264d6996b92b709a8b750b0"></a><a id="t.3"></a><table class="c10"><tr class="c9"><td class="c15" colspan="1" rowspan="1"><p class="c13"><span class="c5">void</span><span class="c3">&nbsp;Player::check_jump_collision(</span><span class="c5">const</span><span class="c3">&nbsp;</span><span class="c6">std</span><span class="c3">::</span><span class="c6">vector</span><span class="c3">&lt;Bounds&gt;&amp; others) {<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="c4">// check bottom and sides using extended bound colliders, for both sides and the bottom</span><span class="c3"><br><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="c4">// amount to extend the collider with proportional to the current size</span><span class="c3"><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="c5">const</span><span class="c3">&nbsp;f64 extend_amount_factor{</span><span class="c11">0.1</span><span class="c3">};<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="c5">const</span><span class="c3">&nbsp;f64 extend_amount{extend_amount_factor * </span><span class="c5">this</span><span class="c3">-&gt;get_rel_bounds().get_size().get_x()};<br><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="c1">const Bounds </span><span class="c6">side_bounds</span><span class="c0">(<br> &nbsp; &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{</span><span class="c1">this</span><span class="c0">-&gt;get_abs_bounds()</span><span class="c1">.</span><span class="c6">get_position</span><span class="c0">()</span><span class="c1">.</span><span class="c6">get_x</span><span class="c0">()</span><span class="c1">&nbsp;- extend_amount, this-&gt;</span><span class="c6">get_abs_bounds</span><span class="c0">()</span><span class="c1">.</span><span class="c6">get_position</span><span class="c0">()</span><span class="c1">.</span><span class="c6">get_y</span><span class="c0">()</span><span class="c1">},<br> &nbsp; &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="c3">{</span><span class="c5">this</span><span class="c3">-&gt;get_rel_bounds().get_size().get_x() + extend_amount * </span><span class="c11">2</span><span class="c3">, </span><span class="c5">this</span><span class="c3">-&gt;get_rel_bounds().get_size().get_y()});<br><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="c1">const Bounds </span><span class="c6">bottom_bounds</span><span class="c0">(<br> &nbsp; &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{</span><span class="c1">this</span><span class="c0">-&gt;get_abs_bounds()</span><span class="c1">.</span><span class="c6">get_position</span><span class="c0">()</span><span class="c1">.</span><span class="c6">get_x</span><span class="c0">()</span><span class="c1">, this-&gt;</span><span class="c6">get_abs_bounds</span><span class="c0">()</span><span class="c1">.</span><span class="c6">get_position</span><span class="c0">()</span><span class="c1">.</span><span class="c6">get_y</span><span class="c0">()</span><span class="c1">&nbsp;- extend_amount},<br> &nbsp; &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="c3">{</span><span class="c5">this</span><span class="c3">-&gt;get_rel_bounds().get_size().get_x(), </span><span class="c5">this</span><span class="c3">-&gt;get_rel_bounds().get_size().get_y() + extend_amount});<br><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;CollideInfo info{};<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="c5">for</span><span class="c3">&nbsp;(</span><span class="c5">const</span><span class="c3">&nbsp;</span><span class="c5">auto</span><span class="c3">&amp; other : others) {<br> &nbsp; &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="c5">const</span><span class="c3">&nbsp;</span><span class="c5">bool</span><span class="c3">&nbsp;side_collides = side_bounds.collides(other);<br> &nbsp; &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="c5">const</span><span class="c3">&nbsp;</span><span class="c5">bool</span><span class="c3">&nbsp;bottom_collides = bottom_bounds.collides(other);<br><br> &nbsp; &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="c5">if</span><span class="c3">&nbsp;(side_collides &amp;&amp; </span><span class="c5">this</span><span class="c3">-&gt;get_abs_bounds().get_position().get_x() &lt; other.get_position().get_x())<br> &nbsp; &nbsp; &nbsp; &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;info.right = </span><span class="c11">true</span><span class="c3">;<br> &nbsp; &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="c5">else</span><span class="c3">&nbsp;</span><span class="c5">if</span><span class="c3">&nbsp;(side_collides)<br> &nbsp; &nbsp; &nbsp; &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;info.left = </span><span class="c11">true</span><span class="c3">;<br><br> &nbsp; &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="c5">if</span><span class="c3">&nbsp;(bottom_collides)<br> &nbsp; &nbsp; &nbsp; &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;info.down = </span><span class="c11">true</span><span class="c3">;<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}<br><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="c5">this</span><span class="c3">-&gt;jump_collider = info;<br>}</span></p></td></tr></table><p class="c7 c16"><span class="c2"></span></p><p class="c7"><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Collision is the only part of the game that I would write differently today. When starting, I added a `project` member function to `Entity`. It updates </span><span>averything</span><span class="c2">&nbsp;physics related except the position. The position is checked inside the `World` and the correct position would be reported back. This worked fine until I needed jump detection. The latter is solved by first composing a list of all `Colliders` and giving these to the `Entity` so it can check whether it can&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;jump or not. I should have done this for the regular collision detection as well.</span></p><h2 class="c8" id="h.y5t46vnuknl8"><span class="c17">Conclusion</span></h2><p class="c7"><span class="c2">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Almost a quarter of the time working on Meat-Boy was spent on thinking about design and how systems would interact with each other. If I were to reimplement this project, I would mostly design it the same, other than the external collision detection. The graphics are a bit crude, but they should be fine as programmer art.</span></p></body></html>